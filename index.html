<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ADMINISTRASI SD NEGERI MAJALENGKA WETAN VIII</title>
    <script src="https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
    
    <style>
        :root { 
            --primary: #1e3a8a; --accent: #3b82f6; --success: #10b981; 
            --danger: #ef4444; --warning: #f59e0b; --dark: #1e293b; --white: #ffffff;
            --shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }
        body { font-family: 'Inter', 'Segoe UI', sans-serif; background: #f1f5f9; margin: 0; padding: 0; color: var(--dark); display: flex; flex-direction: column; min-height: 100vh; }
        .header { background: var(--primary); color: white; padding: 20px; text-align: center; box-shadow: var(--shadow); position: sticky; top: 0; z-index: 100; border-bottom: 4px solid var(--accent); }
        .header h1 { margin: 0; font-size: 1.5rem; letter-spacing: 1px; }
        .header p { margin: 5px 0 0; opacity: 0.9; font-size: 0.85rem; }
        .container { flex: 1; padding: 15px; max-width: 1200px; margin: 0 auto; width: 100%; box-sizing: border-box; }
        .card { background: white; padding: 20px; border-radius: 16px; box-shadow: var(--shadow); margin-bottom: 20px; border: 1px solid rgba(0,0,0,0.05); }
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 12px; margin-bottom: 20px; }
        .btn { padding: 12px 15px; border: none; border-radius: 12px; cursor: pointer; font-weight: 600; font-size: 0.9rem; transition: all 0.3s; display: flex; align-items: center; justify-content: center; gap: 8px; color: white; }
        .btn-primary { background: var(--primary); }
        .btn-accent { background: var(--accent); }
        .btn-green { background: var(--success); }
        .btn-red { background: var(--danger); }
        .btn-warn { background: var(--warning); }
        .btn-dark { background: var(--dark); }
        .btn:active { transform: scale(0.95); }
        input, select, textarea { width: 100%; padding: 12px; margin: 8px 0; border: 1.5px solid #e2e8f0; border-radius: 10px; box-sizing: border-box; font-size: 1rem; }
        input:focus { outline: none; border-color: var(--accent); }
        .table-res { overflow-x: auto; margin-top: 15px; border-radius: 12px; border: 1px solid #e2e8f0; }
        table { width: 100%; border-collapse: collapse; background: white; min-width: 600px; }
        th, td { padding: 12px 15px; border-bottom: 1px solid #eee; text-align: center; font-size: 0.9rem; }
        th { background: #f8fafc; font-weight: 700; color: var(--primary); text-transform: uppercase; font-size: 0.75rem; }
        .tab-content { display: none; animation: fadeIn 0.4s ease; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .login-box { max-width: 400px; margin: 60px auto; text-align: center; }
        .profile-section { display: flex; align-items: center; gap: 15px; margin-bottom: 20px; padding-bottom: 15px; border-bottom: 2px solid #f1f5f9; }
        .profile-img { width: 60px; height: 60px; border-radius: 50%; object-fit: cover; border: 3px solid var(--accent); }
        .status-badge { padding: 4px 8px; border-radius: 6px; font-size: 0.75rem; font-weight: bold; }
        .footer { text-align: center; padding: 20px; font-size: 0.8rem; color: #64748b; }
        #map-link { color: var(--accent); font-weight: bold; text-decoration: none; display: block; margin: 10px 0; }
        .loader { border: 4px solid #f3f3f3; border-top: 4px solid var(--accent); border-radius: 50%; width: 30px; height: 30px; animation: spin 2s linear infinite; margin: 20px auto; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>

    <div class="header">
        <h1 id="main-title">SDN MAJALENGKA WETAN VIII</h1>
        <p id="sub-title">Sistem Administrasi Digital Merdeka</p>
    </div>

    <div class="container">
        <div id="section-login" class="login-box card">
            <img src="https://cdn-icons-png.flaticon.com/512/2602/2602414.png" width="80" style="margin-bottom:15px">
            <h2>Silahkan Masuk</h2>
            <p>Gunakan Kode Akses Guru/Kepsek</p>
            <input type="password" id="pass" placeholder="Masukkan Kode Akses..." onkeyup="if(event.key==='Enter') login()">
            <button class="btn btn-primary" style="width:100%" onclick="login()">MASUK SISTEM</button>
        </div>

        <div id="section-app" style="display:none">
            
            <div class="card profile-section">
                <img id="my-foto" class="profile-img" src="https://via.placeholder.com/100">
                <div style="text-align:left">
                    <h3 id="my-name" style="margin:0">-</h3>
                    <p id="my-role" style="margin:0; font-size:0.8rem; color:var(--accent)">-</p>
                </div>
                <button class="btn btn-red" style="margin-left:auto; padding:8px" onclick="location.reload()">LOGOUT</button>
            </div>

            <div id="menu-guru" class="grid" style="display:none">
                <button class="btn btn-accent" onclick="showTab('tab-absen')">üïí PRESENSI</button>
                <button class="btn btn-primary" onclick="showTab('tab-kurikulum')">üìö KURIKULUM</button>
                <button class="btn btn-green" onclick="showTab('tab-agenda')">üìù AGENDA</button>
                <button class="btn btn-warn" onclick="showTab('tab-nilai')">üìä NILAI</button>
                <button class="btn btn-dark" onclick="showTab('tab-config')">‚öôÔ∏è PENGATURAN</button>
            </div>

            <div id="menu-kepsek" class="grid" style="display:none">
                <button class="btn btn-primary" onclick="renderMonitorAbsenGuru()">üë®‚Äçüè´ ABSEN GURU</button>
                <button class="btn btn-green" onclick="renderMonitorAgenda()">üìã CEK AGENDA</button>
                <button class="btn btn-accent" onclick="renderMonitorKOSP()">üìÅ KOSP/LINK</button>
                <button class="btn btn-warn" onclick="renderMonitorNilai()">üìâ REKAP NILAI</button>
            </div>

            <div id="tab-absen" class="tab-content card">
                <h3>Presensi Kehadiran GPS</h3>
                <p id="jam-now" style="font-size:1.5rem; font-weight:bold; color:var(--primary)">00:00:00</p>
                <div id="absen-status-box">Menunggu Lokasi...</div>
                <input type="text" id="ket-absen" placeholder="Keterangan (Opsional)...">
                <button id="btn-ceklok" class="btn btn-green" style="width:100%; margin-top:10px" onclick="doAbsen()" disabled>CEKLOK SEKARANG</button>
                <a id="map-link" href="#" target="_blank">Lihat Lokasi Saya di Map</a>
            </div>

            <div id="tab-kurikulum" class="tab-content card">
                <h3>Manajemen CP / TP / ATP</h3>
                <select id="k-mapel"><option>Bahasa Indonesia</option><option>Matematika</option><option>IPAS</option><option>Pancasila</option><option>PJOK</option><option>Seni Budaya</option><option>B. Inggris</option><option>B. Sunda</option><option>PAI</option></select>
                <textarea id="k-cp" placeholder="Input Capaian Pembelajaran (CP)..."></textarea>
                <textarea id="k-tp" placeholder="Input Tujuan Pembelajaran (TP)..."></textarea>
                <textarea id="k-atp" placeholder="Alur Tujuan Pembelajaran (ATP)..."></textarea>
                <button class="btn btn-primary" onclick="saveKurikulum()">SIMPAN DATA</button>
            </div>

            <div id="tab-agenda" class="tab-content card">
                <h3>Agenda Harian & Modul Ajar</h3>
                <input type="date" id="ag-tgl">
                <input type="text" id="ag-mapel" placeholder="Mata Pelajaran">
                <input type="number" id="ag-kls" placeholder="Kelas">
                <textarea id="ag-materi" placeholder="Materi / Langkah Pembelajaran"></textarea>
                <p>Foto Kegiatan:</p>
                <input type="file" id="ag-foto" accept="image/*">
                <button class="btn btn-green" onclick="saveAgenda()">KIRIM AGENDA</button>
                <hr>
                <h4>Riwayat Agenda Saya</h4>
                <div id="list-agenda-saya"></div>
            </div>

            <div id="tab-nilai" class="tab-content card">
                <h3>Input Nilai Sumatif</h3>
                <div id="nilai-form">
                    <button class="btn btn-accent" onclick="generateFormatNilai()">1. BUAT FORMAT SISWA</button>
                    <div id="area-input-nilai" class="table-res"></div>
                    <button class="btn btn-primary" style="margin-top:10px" onclick="saveNilai()">2. SIMPAN SEMUA NILAI</button>
                </div>
            </div>

            <div id="tab-config" class="tab-content card">
                <h3>Pengaturan Profil</h3>
                <p>Ganti Foto Profil:</p>
                <input type="file" id="cfg-foto" accept="image/*" onchange="uploadFotoProfil()">
                <input type="text" id="cfg-link-kosp" placeholder="Link Google Drive KOSP / Perangkat">
                <button class="btn btn-primary" onclick="saveConfig()">UPDATE PROFIL</button>
            </div>

            <div id="tab-kepsek" class="tab-content card">
                <h3 id="monitor-title">Monitoring</h3>
                <div id="area-monitor-kepsek"></div>
            </div>

        </div>
    </div>

    <div class="footer">
        &copy; 2024 SD Negeri Majalengka Wetan VIII<br>Digitalisasi Administrasi Kurikulum Merdeka
    </div>

    <script>
        // CONFIG FIREBASE
        const firebaseConfig = {
            databaseURL: "https://wetandelapan-default-rtdb.firebaseio.com/"
        };
        firebase.initializeApp(firebaseConfig);
        const rtdb = firebase.database();

        // DATA GURU
        const allGurus = [
            {id: 'KEPSEK', nama: 'Hj. NENENG HERNI, S.Pd.', pass: '12345', role: 'Kepala Sekolah'},
            {id: 'GK1', nama: 'Guru Kelas 1', pass: '111', role: 'Guru Kelas'},
            {id: 'GK2', nama: 'Guru Kelas 2', pass: '222', role: 'Guru Kelas'},
            {id: 'GK3', nama: 'Guru Kelas 3', pass: '333', role: 'Guru Kelas'},
            {id: 'GK4', nama: 'Guru Kelas 4', pass: '444', role: 'Guru Kelas'},
            {id: 'GK5', nama: 'Guru Kelas 5', pass: '555', role: 'Guru Kelas'},
            {id: 'GK6', nama: 'Guru Kelas 6', pass: '666', role: 'Guru Kelas'},
            {id: 'GPAI', nama: 'Guru PAI', pass: '777', role: 'Guru Mapel'},
            {id: 'GPJOK', nama: 'Guru PJOK', pass: '888', role: 'Guru Mapel'}
        ];

        let curUser = null;
        const SEKO_LAT = -6.8373; 
        const SEKO_LNG = 108.2250; 
        let userLat = 0, userLng = 0;

        // LOGIN FUNCTION
        function login() {
            const p = document.getElementById('pass').value;
            const user = allGurus.find(u => u.pass === p);
            if(user) {
                curUser = user;
                document.getElementById('section-login').style.display = 'none';
                document.getElementById('section-app').style.display = 'block';
                document.getElementById('my-name').innerText = user.nama;
                document.getElementById('my-role').innerText = user.role;
                
                if(user.id === 'KEPSEK') {
                    document.getElementById('menu-kepsek').style.display = 'grid';
                    renderMonitorAbsenGuru();
                } else {
                    document.getElementById('menu-guru').style.display = 'grid';
                    showTab('tab-absen');
                }
                loadProfile();
            } else {
                alert('Kode Akses Salah!');
            }
        }

        function showTab(id) {
            document.querySelectorAll('.tab-content').forEach(t => t.style.display = 'none');
            document.getElementById(id).style.display = 'block';
            if(id === 'tab-agenda') loadMyAgenda();
        }

        function switchTab(id) { showTab(id); }

        // REALTIME CLOCK & GPS
        setInterval(() => {
            const now = new Date();
            document.getElementById('jam-now').innerText = now.toLocaleTimeString('id-ID');
        }, 1000);

        if(navigator.geolocation) {
            navigator.geolocation.watchPosition(pos => {
                userLat = pos.coords.latitude;
                userLng = pos.coords.longitude;
                const dist = getDist(userLat, userLng, SEKO_LAT, SEKO_LNG);
                const box = document.getElementById('absen-status-box');
                const btn = document.getElementById('btn-ceklok');
                document.getElementById('map-link').href = `https://www.google.com/maps?q=${userLat},${userLng}`;
                
                if(dist <= 100) {
                    box.innerHTML = `<b style="color:green">üìç Anda di Sekolah (${Math.round(dist)}m)</b>`;
                    btn.disabled = false;
                } else {
                    box.innerHTML = `<b style="color:red">üìç Diluar Jangkauan (${Math.round(dist)}m)</b>`;
                    btn.disabled = true;
                }
            });
        }

        function getDist(lat1, lon1, lat2, lon2) {
            const R = 6371e3;
            const œÜ1 = lat1 * Math.PI/180;
            const œÜ2 = lat2 * Math.PI/180;
            const ŒîœÜ = (lat2-lat1) * Math.PI/180;
            const ŒîŒª = (lon2-lon1) * Math.PI/180;
            const a = Math.sin(ŒîœÜ/2) * Math.sin(ŒîœÜ/2) + Math.cos(œÜ1) * Math.cos(œÜ2) * Math.sin(ŒîŒª/2) * Math.sin(ŒîŒª/2);
            return R * 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
        }

        // ABSENSI GURU
        function doAbsen() {
            const tgl = new Date().toISOString().split('T')[0];
            const jam = new Date().toLocaleTimeString('id-ID');
            const limit = "06:30:00";
            let status = jam > limit ? "TERLAMBAT" : "HADIR";
            
            rtdb.ref(`presensi_guru/${tgl}/${curUser.id}`).set({
                nama: curUser.nama,
                waktu: jam,
                status: status,
                ket: document.getElementById('ket-absen').value,
                loc: `${userLat},${userLng}`
            }).then(() => alert('Absen Berhasil: ' + status));
        }

        // KURIKULUM & AGENDA
        function saveKurikulum() {
            const data = {
                cp: document.getElementById('k-cp').value,
                tp: document.getElementById('k-tp').value,
                atp: document.getElementById('k-atp').value
            };
            rtdb.ref(`sekolah_wetan/${curUser.id}/kurikulum/${document.getElementById('k-mapel').value}`).set(data)
            .then(() => alert('Data Kurikulum Tersimpan'));
        }

        async function saveAgenda() {
            const file = document.getElementById('ag-foto').files[0];
            let base64 = "";
            if(file) {
                const reader = new FileReader();
                reader.readAsDataURL(file);
                reader.onload = () => {
                    base64 = reader.result;
                    pushAgenda(base64);
                };
            } else { pushAgenda(""); }
        }

        function pushAgenda(img) {
            const newAg = {
                tgl: document.getElementById('ag-tgl').value,
                mapel: document.getElementById('ag-mapel').value,
                kls: document.getElementById('ag-kls').value,
                materi: document.getElementById('ag-materi').value,
                foto: img,
                status: 'Menunggu Persetujuan'
            };
            rtdb.ref(`sekolah_wetan/${curUser.id}/agenda`).once('value', s => {
                let list = s.val() || [];
                list.push(newAg);
                rtdb.ref(`sekolah_wetan/${curUser.id}/agenda`).set(list).then(() => {
                    alert('Agenda Terkirim ke Kepala Sekolah');
                    loadMyAgenda();
                });
            });
        }

        function loadMyAgenda() {
            const area = document.getElementById('list-agenda-saya');
            rtdb.ref(`sekolah_wetan/${curUser.id}/agenda`).on('value', s => {
                let data = s.val() || [];
                let html = '<div class="table-res"><table><thead><tr><th>TGL</th><th>MAPEL</th><th>STATUS</th></tr></thead><tbody>';
                data.forEach(a => {
                    html += `<tr><td>${a.tgl}</td><td>${a.mapel}</td><td>${a.status}</td></tr>`;
                });
                area.innerHTML = html + '</tbody></table></div>';
            });
        }

        // MANAJEMEN NILAI
        function generateFormatNilai() {
            const area = document.getElementById('area-input-nilai');
            let html = '<table><thead><tr><th>NAMA SISWA</th><th>TP1</th><th>TP2</th><th>STS</th><th>SAS</th></tr></thead><tbody>';
            for(let i=1; i<=10; i++) {
                html += `<tr>
                    <td><input type="text" id="n-nama-${i}" placeholder="Nama Siswa ${i}"></td>
                    <td><input type="number" id="n-tp1-${i}"></td>
                    <td><input type="number" id="n-tp2-${i}"></td>
                    <td><input type="number" id="n-sts-${i}"></td>
                    <td><input type="number" id="n-sas-${i}"></td>
                </tr>`;
            }
            area.innerHTML = html + '</tbody></table>';
        }

        function saveNilai() {
            let allNilai = [];
            for(let i=1; i<=10; i++) {
                if(document.getElementById(`n-nama-${i}`).value) {
                    allNilai.push({
                        nama: document.getElementById(`n-nama-${i}`).value,
                        tp1: document.getElementById(`n-tp1-${i}`).value,
                        tp2: document.getElementById(`n-tp2-${i}`).value,
                        sts: document.getElementById(`n-sts-${i}`).value,
                        sas: document.getElementById(`n-sas-${i}`).value
                    });
                }
            }
            rtdb.ref(`sekolah_wetan/${curUser.id}/nilai`).set(allNilai).then(() => alert('Nilai Berhasil Disimpan'));
        }

        // CONFIG & PROFILE
        function uploadFotoProfil() {
            const file = document.getElementById('cfg-foto').files[0];
            const reader = new FileReader();
            reader.readAsDataURL(file);
            reader.onload = () => {
                const b64 = reader.result;
                rtdb.ref(`sekolah_wetan/${curUser.id}/cfg/foto`).set(b64);
                document.getElementById('my-foto').src = b64;
            };
        }

        function saveConfig() {
            rtdb.ref(`sekolah_wetan/${curUser.id}/cfg/linkKosp`).set(document.getElementById('cfg-link-kosp').value);
            rtdb.ref(`sekolah_wetan/${curUser.id}/cfg/guru`).set(curUser.nama);
            alert('Konfigurasi Disimpan');
        }

        function loadProfile() {
            rtdb.ref(`sekolah_wetan/${curUser.id}/cfg`).once('value', s => {
                const d = s.val();
                if(d) {
                    if(d.foto) document.getElementById('my-foto').src = d.foto;
                    if(d.linkKosp) document.getElementById('cfg-link-kosp').value = d.linkKosp;
                }
            });
        }

        // ==========================================
        // PERBAIKAN FITUR MONITORING KEPALA SEKOLAH 
        // ==========================================

        // 1. MONITORING AGENDA (Persetujuan Guru)
        function renderMonitorAgenda() {
            switchTab('tab-kepsek'); 
            document.getElementById('monitor-title').innerText = 'üìã Persetujuan Agenda Guru';
            const area = document.getElementById('area-monitor-kepsek');
            area.innerHTML = "<div class='loader'></div><p align='center'>Memuat data agenda...</p>";

            rtdb.ref('sekolah_wetan').on('value', snapshot => {
                const allData = snapshot.val();
                if (!allData) { area.innerHTML = "Belum ada data."; return; }

                let html = '<div class="table-res"><table><thead><tr><th>GURU</th><th>MAPEL</th><th>TGL</th><th>MATERI</th><th>AKSI</th></tr></thead><tbody>';
                let found = false;

                for (let role in allData) {
                    if (allData[role].agenda && Array.isArray(allData[role].agenda)) {
                        allData[role].agenda.forEach((a, i) => {
                            if (a.status !== '‚úÖ Disetujui') {
                                found = true;
                                html += `<tr>
                                    <td><b>${allData[role].cfg && allData[role].cfg.guru ? allData[role].cfg.guru : role}</b></td>
                                    <td>${a.mapel}</td>
                                    <td>${a.tgl}</td>
                                    <td>${a.materi}</td>
                                    <td><button class="btn btn-green" onclick="appAg('${role}', ${i})">Setujui</button></td>
                                </tr>`;
                            }
                        });
                    }
                }
                area.innerHTML = found ? html + '</tbody></table></div>' : "<p align='center'>Semua agenda sudah disetujui (Rapi).</p>";
            });
        }

        // 2. MONITORING PRESENSI GURU (Real-Time)
        function renderMonitorAbsenGuru() {
            switchTab('tab-kepsek'); 
            document.getElementById('monitor-title').innerText = 'üë®‚Äçüè´ Monitor Kehadiran Guru';
            const area = document.getElementById('area-monitor-kepsek');
            const tgl = new Date().toISOString().split('T')[0];

            rtdb.ref(`presensi_guru/${tgl}`).on('value', snap => {
                const dataHadir = snap.val() || {};
                let html = `<p>Tanggal: <b>${tgl}</b></p><div class="table-res"><table><thead><tr><th>NAMA GURU</th><th>JAM</th><th>STATUS</th></tr></thead><tbody>`;
                
                allGurus.forEach(g => {
                    if (g.id === 'KEPSEK') return;
                    const h = dataHadir[g.id] || { status: 'üî¥ Belum Absen', waktu: '-' };
                    let color = h.status === 'HADIR' ? '#10b981' : (h.status === 'TERLAMBAT' ? '#f59e0b' : '#ef4444');
                    html += `<tr>
                        <td style="text-align:left">${g.nama}</td>
                        <td>${h.waktu}</td>
                        <td><b style="color:${color}">${h.status}</b></td>
                    </tr>`;
                });
                area.innerHTML = html + '</tbody></table></div>';
            });
        }

        // 3. MONITORING KOSP & LINK DOKUMEN
        function renderMonitorKOSP() {
            switchTab('tab-kepsek');
            document.getElementById('monitor-title').innerText = 'üìÅ Monitoring Dokumen & KOSP';
            const area = document.getElementById('area-monitor-kepsek');
            area.innerHTML = "Memeriksa dokumen...";

            rtdb.ref('sekolah_wetan').once('value', snapshot => {
                const all = snapshot.val();
                let html = '<div class="table-res"><table><thead><tr><th>GURU</th><th>LINK KOSP / PERANGKAT</th><th>AKSI</th></tr></thead><tbody>';
                let any = false;
                
                for (let r in all) {
                    if (r === 'KEPSEK') continue;
                    any = true;
                    const link = all[r].cfg ? (all[r].cfg.linkKosp || '#') : '#';
                    const statusLink = link !== '#' ? '‚úÖ Tersedia' : '‚ùå Belum Upload';
                    
                    html += `<tr>
                        <td style="text-align:left">${(all[r].cfg && all[r].cfg.guru) ? all[r].cfg.guru : r}</td>
                        <td>${statusLink}</td>
                        <td><a href="${link}" target="_blank" class="btn ${link !== '#' ? 'btn-accent' : 'btn-dark'}" style="text-decoration:none">Buka Link</a></td>
                    </tr>`;
                }
                area.innerHTML = any ? html + '</tbody></table></div>' : "Tidak ada data guru.";
            });
        }

        // 4. MONITORING NILAI SISWA
        function renderMonitorNilai() {
            switchTab('tab-kepsek');
            document.getElementById('monitor-title').innerText = 'üìä Status Nilai Rapor';
            const area = document.getElementById('area-monitor-kepsek');

            rtdb.ref('sekolah_wetan').once('value', snap => {
                const all = snap.val();
                let html = '<div class="table-res"><table><thead><tr><th>KELAS / GURU</th><th>DATA NILAI</th></tr></thead><tbody>';
                let any = false;
                
                for (let r in all) {
                    if(r === 'KEPSEK') continue;
                    any = true;
                    const d = all[r];
                    const cekNilai = d.nilai ? `‚úÖ ${d.nilai.length} Siswa Terisi` : '‚ùå Belum Ada Data';
                    
                    html += `<tr>
                        <td style="text-align:left"><b>${r}</b><br><small>${d.cfg ? d.cfg.guru : ''}</small></td>
                        <td><b>${cekNilai}</b></td>
                    </tr>`;
                }
                area.innerHTML = any ? html + '</tbody></table></div>' : "Belum ada data nilai.";
            });
        }

        // FUNGSI EKSEKUSI PERSETUJUAN
        async function appAg(r, i) {
            if(confirm("Setujui agenda ini secara resmi?")) {
                try {
                    await rtdb.ref(`sekolah_wetan/${r}/agenda/${i}/status`).set('‚úÖ Disetujui');
                    alert('Agenda Berhasil Disetujui!');
                } catch(e) {
                    alert('Gagal: ' + e.message);
                }
            }
        }
    </script>
</body>
</html>
